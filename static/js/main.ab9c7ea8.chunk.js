(this.webpackJsonpdigit_recognizer=this.webpackJsonpdigit_recognizer||[]).push([[0],{19:function(e,t,n){e.exports=n(49)},24:function(e,t,n){},25:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},34:function(e,t){},35:function(e,t){},36:function(e,t){},37:function(e,t){},38:function(e,t){},39:function(e,t){},42:function(e,t){},43:function(e,t){},44:function(e,t){},49:function(e,t,n){"use strict";n.r(t);var a,r,i,s=n(1),o=n.n(s),c=n(13),l=n.n(c),u=(n(24),n(25),n(3)),d=n.n(u),h=n(4),f=n(9),m=n(10),g=n(18),p=n(16),b=(n(27),n(28),["btn--primary--solid","btn--warning--solid","btn--danger--solid","btn--success--solid","btn--primary--outline","btn--warning--outline","btn--danger--outline","btn--success--outline"]),v=["btn--medium","btn--large"],w=function(e){var t=e.children,n=e.type,a=e.onClick,r=e.buttonStyle,i=e.buttonSize,s=b.includes(r)?r:b[0],c=v.includes(i)?i:v[0];return o.a.createElement("button",{className:"btn ".concat(s," ").concat(c),onClick:a,type:n},t)},y=n(2),x=n(17),k=function(){function e(){Object(f.a)(this,e),this.shuffledTrainIndex=0,this.shuffledTestIndex=0}return Object(m.a)(e,[{key:"load",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,a,r,i,s,o,c,l=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Image,n=document.createElement("canvas"),a=n.getContext("2d"),r=new Promise((function(e,r){t.crossOrigin="",t.onload=function(){t.width=t.naturalWidth,t.height=t.naturalHeight;var r=new ArrayBuffer(20384e4);n.width=t.width,n.height=5e3;for(var i=0;i<13;i++){var s=new Float32Array(r,784*i*5e3*4,392e4);a.drawImage(t,0,5e3*i,t.width,5e3,0,0,t.width,5e3);for(var o=a.getImageData(0,0,n.width,n.height),c=0;c<o.data.length/4;c++)s[c]=o.data[4*c]/255}l.datasetImages=new Float32Array(r),e()},t.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"})),i=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),e.next=7,Promise.all([r,i]);case 7:return s=e.sent,o=Object(x.a)(s,2),o[0],c=o[1],e.t0=Uint8Array,e.next=14,c.arrayBuffer();case 14:e.t1=e.sent,this.datasetLabels=new e.t0(e.t1),this.trainIndices=y.i.createShuffledIndices(55e3),this.testIndices=y.i.createShuffledIndices(1e4),this.trainImages=this.datasetImages.slice(0,4312e4),this.testImages=this.datasetImages.slice(4312e4),this.trainLabels=this.datasetLabels.slice(0,55e4),this.testLabels=this.datasetLabels.slice(55e4);case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nextTrainBatch",value:function(e){var t=this;return this.nextBatch(e,[this.trainImages,this.trainLabels],(function(){return t.shuffledTrainIndex=(t.shuffledTrainIndex+1)%t.trainIndices.length,t.trainIndices[t.shuffledTrainIndex]}))}},{key:"nextTestBatch",value:function(e){var t=this;return this.nextBatch(e,[this.testImages,this.testLabels],(function(){return t.shuffledTestIndex=(t.shuffledTestIndex+1)%t.testIndices.length,t.testIndices[t.shuffledTestIndex]}))}},{key:"nextBatch",value:function(e,t,n){for(var a=new Float32Array(784*e),r=new Uint8Array(10*e),i=0;i<e;i++){var s=n(),o=t[0].slice(784*s,784*s+784);a.set(o,784*i);var c=t[1].slice(10*s,10*s+10);r.set(c,10*i)}return{xs:y.f(a,[e,784]),labels:y.f(r,[e,10])}}}]),e}(),I=(n(40),n(41),n(14)),S=n(15),E=n.n(S),C=function(e){Object(g.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(f.a)(this,n),(e=t.call(this)).state={trainingComplete:!1,series:[{name:"Probability",data:[0,0,0,0,0,0,0,0,0,0]}],options:{chart:{height:350,type:"bar"},plotOptions:{bar:{dataLabels:{position:"top"}}},dataLabels:{enabled:!0,formatter:function(e){return e+"%"},position:"top",offsetY:-20,style:{fontSize:"12px",colors:["#304758"]}},xaxis:{categories:["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],position:"buttom",axisBorder:{show:!0},axisTicks:{show:!1},crosshairs:{fill:{type:"gradient",gradient:{colorFrom:"#D8E3F0",colorTo:"#BED1E6",stops:[0,100],opacityFrom:.4,opacityTo:.5}}},tooltip:{enabled:!0}},yaxis:{axisBorder:{show:!0},axisTicks:{show:!1},labels:{show:!1,formatter:function(e){return e+"%"}}},title:{floating:!0,offsetY:330,align:"center",style:{color:"#000000"}}}},e}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new I.fabric.Canvas("canvas",{backgroundColor:"rgb(0, 0, 0)"})).isDrawingMode=!0,i.freeDrawingBrush.width=11,i.freeDrawingBrush.color="rgb(255, 255, 255)",this.createModel(),e.next=7,this.load();case 7:return e.next=9,this.train();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createModel",value:function(){console.log("Create model"),a=y.e(),console.log("Model created"),console.log("Add layers"),a.add(y.c.conv2d({inputShape:[28,28,1],kernelSize:5,filters:8,strides:1,activation:"relu",kernelInitializer:"VarianceScaling"})),a.add(y.c.maxPooling2d({poolSize:[2,2],strides:[2,2]})),a.add(y.c.conv2d({kernelSize:5,filters:16,strides:1,activation:"relu",kernelInitializer:"VarianceScaling"})),a.add(y.c.maxPooling2d({poolSize:[2,2],strides:[2,2]})),a.add(y.c.flatten()),a.add(y.c.dense({units:10,kernelInitializer:"VarianceScaling",activation:"softmax"})),console.log("Layers created"),console.log("Start compiling ..."),a.compile({optimizer:y.h.sgd(.15),loss:"categoricalCrossentropy"}),console.log("Compiled")}},{key:"load",value:function(){var e=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading MNIST data ..."),r=new k,e.next=4,r.load();case 4:console.log("Data loaded successfully");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"train",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Start training ..."),t=0;case 2:if(!(t<150)){e.next=12;break}return n=y.g((function(){var e=r.nextTrainBatch(64);return e.xs=e.xs.reshape([64,28,28,1]),e})),e.next=6,a.fit(n.xs,n.labels,{batchSize:64,epochs:1});case 6:return y.b(n),e.next=9,y.d();case 9:t++,e.next=2;break;case 12:this.setState({trainingComplete:!0}),console.log("Training complete");case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,r,s,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.getElement(),n=y.a.fromPixels(t).resizeNearestNeighbor([28,28]).mean(2).expandDims(2).expandDims().toFloat(),e.next=4,a.predict(n);case 4:for(r=(r=e.sent).dataSync(),console.log(r),s=new Array(10),o=0;o<10;o++)r[o]*=100,c=Math.round(100*r[o]),s[o]=c/100;this.setState({series:[{name:"Probability",data:s}]}),console.log(r);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"clearCanvas",value:function(){i.clear(),i.setBackgroundColor("rgb(0, 0, 0)"),this.setState({series:[{name:"Probability",data:[0,0,0,0,0,0,0,0,0,0]}]})}},{key:"render",value:function(){var e,t,n=this;return e=this.state.trainingComplete?o.a.createElement(w,{className:"loading",onClick:Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.predict();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),type:"button",buttonStyle:"btn--success--outline",buttonSize:"btn--medium"},"Predict Handwriting"):o.a.createElement("div",{className:"loading"},o.a.createElement("div",{className:"spinner"},o.a.createElement("div",{className:"bounce1"}),o.a.createElement("div",{className:"bounce2"}),o.a.createElement("div",{className:"bounce3"}))),this.state.trainingComplete||(t=o.a.createElement("p",null,'Please wait for the ML model training to complete, and then write any digit on the canvas then click "Predict Handwritting"')),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"container1"},o.a.createElement("canvas",{className:"drawingCanvas",id:"canvas",width:"300",height:"300"}),o.a.createElement(E.a,{className:"chart",options:this.state.options,series:this.state.series,type:"bar",width:"500"})),o.a.createElement("div",{className:"container2"},o.a.createElement(w,{className:"but",onClick:function(){return n.clearCanvas()},type:"button",buttonStyle:"btn--primary--outline",buttonSize:"btn--medium"},"Clear"),e),t)}}]),n}(s.Component);var T=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(C,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[19,1,2]]]);
//# sourceMappingURL=main.ab9c7ea8.chunk.js.map